<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap"
      rel="stylesheet"
    />
    <!--=============== FAVICON ===============-->
    <link
      rel="shortcut icon"
      href="./img/favicon_package/favicon.ico"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="./style.css" />
    <title>Zombie Game Project</title>
  </head>
  <body>
    <button id="btn-start" onclick="" class="btn-start">Start Game</button>
    <div class="infos">
      <p>🎈 Score: <span id="text-score">0</span></p>
      <p>🎈 Time remaining: <span id="text-time">0</span> second</p>
      <p>🎈 Highest Score Player: <span id="text-highscorename"></span></p>
      <p>🎈 Highest Score: <span id="text-highscore">0</span></p>
      <p>⚙️ Restart: Keyboard'R'</p>
      <p>⚙️ Change Mode: Keyboard'K'</p>
    </div>
    <div id="game"></div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
      integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      // 分數
      let score = 0;
      // 剩餘秒數
      let countdown = 0;
      // 計時器
      let timer = 0;
      // 最高分
      // const storage = JSON.parse(localStorage.getItem('zombiegame'))
      const highscore = localStorage.zombiegame
        ? JSON.parse(localStorage.zombiegame)
        : { name: "", score: 0 };
      $("#text-highscorename").text(highscore.name);
      $("#text-highscore").text(highscore.score);

      // 移動

      function move(anna) {
        const top = Math.round(Math.random() * 10) + "%";
        const left = Math.round(Math.random() * 50) + "%";
        anna.animate({ top, left }, 2000, function () {
          // 判斷遊戲結束後就遞迴停止
          if ($("#btn-start").attr("disabled") === "disabled") {
            move(anna);
          }
        });
      }
      function move(brahms) {
        const top = Math.round(Math.random() * 50) + "%";
        const left = Math.round(Math.random() * 100) + "%";
        brahms.animate({ top, left }, 2000, function () {
          // 判斷遊戲結束後就遞迴停止
          if ($("#btn-start").attr("disabled") === "disabled") {
            move(brahms);
          }
        });
      }
      function move(billy) {
        const top = Math.round(Math.random() * 30) + "%";
        const left = Math.round(Math.random() * 60) + "%";
        anbillyna.animate({ top, left }, 2000, function () {
          // 判斷遊戲結束後就遞迴停止
          if ($("#btn-start").attr("disabled") === "disabled") {
            move(billy);
          }
        });
      }
      function move(zombie) {
        const top = Math.round(Math.random() * 100) + "%";
        const left = Math.round(Math.random() * 200) + "%";
        zombie.animate({ top, left }, 2000, function () {
          // 判斷遊戲結束後就遞迴停止
          if ($("#btn-start").attr("disabled") === "disabled") {
            move(zombie);
          }
        });
      }
      function move(chucky) {
        const top = Math.round(Math.random() * 40) + "%";
        const left = Math.round(Math.random() * 80) + "%";
        chucky.animate({ top, left }, 2000, function () {
          // 判斷遊戲結束後就遞迴停止
          if ($("#btn-start").attr("disabled") === "disabled") {
            move(chucky);
          }
        });
      }
      function move(slappy) {
        const top = Math.round(Math.random() * 70) + "%";
        const left = Math.round(Math.random() * 140) + "%";
        slappy.animate({ top, left }, 2000, function () {
          // 判斷遊戲結束後就遞迴停止
          if ($("#btn-start").attr("disabled") === "disabled") {
            move(slappy);
          }
        });
      }

      $("#btn-start").click(function () {
        // 停用開始按鈕
        $(this).attr("disabled", true);
        $("#btn-start").hide();
        // 重設
        score = 0;
        $("#text-score").text(score);
        countdown = 10;
        $("#text-time").text(countdown);
        // 開始遊戲
        timer = setInterval(function () {
          // 倒數
          countdown--;
          $("#text-time").text(countdown);
          const random = Math.ceil(Math.random() * 10);
          console.log(random);
          // 產生隨機位置的殭屍
          if (random > 5 && $(".anna").length < 2) {
            const top = Math.round(Math.random() * 100) + "%";
            const left = Math.round(Math.random() * 100) + "%";
            const anna = $(
              `<img src="./img/anna.png" class="anna" data-num="6" style="top: ${top}; left: ${left}">`
            );
            $("#game").append(anna);
            move(anna);
          }
          if (random > 5 && $(".brahms").length < 2) {
            const top = Math.round(Math.random() * 100) + "%";
            const left = Math.round(Math.random() * 100) + "%";
            const brahms = $(
              `<img src="./img/brahms.png" class="brahms" data-num="4" style="top: ${top}; left: ${left}">`
            );
            $("#game").append(brahms);
            move(brahms);
          }
          if (random > 5 && $(".billy").length < 2) {
            const top = Math.round(Math.random() * 100) + "%";
            const left = Math.round(Math.random() * 100) + "%";
            const billy = $(
              `<img src="./img/billy.png" class="billy" data-num="5" style="top: ${top}; left: ${left}">`
            );
            $("#game").append(billy);
            move(billy);
          }
          if (random > 5 && $(".zombie").length < 2) {
            const top = Math.round(Math.random() * 100) + "%";
            const left = Math.round(Math.random() * 100) + "%";
            const zombie = $(
              `<img src="./img/0.png" class="zombie" data-num="4" style="top: ${top}; left: ${left}">`
            );
            $("#game").append(zombie);
            move(zombie);
          }
          if (random > 5 && $(".chucky").length < 2) {
            const top = Math.round(Math.random() * 100) + "%";
            const left = Math.round(Math.random() * 100) + "%";
            const chucky = $(
              `<img src="./img/chucky.png" class="chucky" data-num="3" style="top: ${top}; left: ${left}">`
            );
            $("#game").append(chucky);
            move(chucky);
          }
          if (random > 5 && $(".slappy").length < 2) {
            const top = Math.round(Math.random() * 100) + "%";
            const left = Math.round(Math.random() * 100) + "%";
            const slappy = $(
              `<img src="./img/slappy.png" class="slappy" data-num="1" style="top: ${top}; left: ${left}">`
            );
            $("#game").append(slappy);
            move(slappy);
          }

          // 時間到
          if (countdown === 0) {
            // 停止倒數
            clearInterval(timer);
            // 清空
            $("#game img").remove();
            // 重新啟用開始按鈕
            $("#btn-start").attr("disabled", false);
            $("#btn-start").show();
            if (score > highscore.score) {
              Swal.fire({
                icon: "info",
                title: "時間到",
                text: `最高分，你得到 ${score} 分`,
                inputPlaceholder: "請輸入名字",
                input: "text",
                inputAttributes: {
                  required: true,
                },
                validationMessage: "名稱必填",
                allowOutsideClick: false,
                allowEscapeKey: false,
              }).then((result) => {
                highscore.score = score;
                highscore.name = result.value;
                $("#text-highscorename").text(highscore.name);
                $("#text-highscore").text(highscore.score);

                // localStorage.setItem('zombiegame', JSON.stringify(highscore))
                localStorage.zombiegame = JSON.stringify(highscore);
              });
            } else {
              Swal.fire({
                icon: "info",
                title: "時間到",
                text: `你得到 ${score} 分`,
              });
            }
          }
        }, 1000);
      });

      $("#game").on("click", "img", function () {
        $(this).attr("src", "./img/blood.png");
        $(this).removeData("num").addClass("blood");
        $(this).stop();
        const scoreNum = $(this).attr("data-num");
        // console.log(scoreNum);
        score += parseInt(scoreNum * 10);
        $("#text-score").text(score);
      });
      function resetGame() {
        // 停止倒數
        clearInterval(timer);
        score = 0;
        $("#text-score").text(score);
        countdown = 10;
        $("#text-time").text(countdown);
        // 清空
        $("#game img").remove();
        // 重新啟用開始按鈕
        $("#btn-start").attr("disabled", false);
        $("#game").removeClass("moving");
      }
      resetGame();

      $(window).keydown(function (evt) {
        console.log(evt.key);
        if (evt.key == "r") {
          resetGame();
        }
        if (evt.key == "k") {
          $("#game").toggleClass("moving");
          // resetGame();
        }
      });
    </script>
  </body>
</html>
